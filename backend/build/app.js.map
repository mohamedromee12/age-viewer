{"version":3,"file":"app.js","names":["express","require","cors","session","uuid","path","cookieParser","logger","_require","stream","cypherRouter","databaseRouter","sessionRouter","miscellaneousRouter","app","use","origin","credentials","join","__dirname","get","req","res","sendFile","secret","secure","resave","saveUninitialized","proxy","genid","v4","json","urlencoded","extended","err","next","console","error","status","severity","message","code","process","on","exception","log","module","exports"],"sources":["../src/app.js"],"sourcesContent":["/*\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n * http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\nconst express = require('express');\nconst cors = require('cors');\nconst session = require('express-session');\nconst uuid = require('uuid');\nconst path = require('path');\nconst cookieParser = require('cookie-parser');\nconst logger = require('morgan');\nconst {stream} = require('./config/winston');\nconst cypherRouter = require('./routes/cypherRouter');\nconst databaseRouter = require('./routes/databaseRouter');\nconst sessionRouter = require('./routes/sessionRouter');\nconst miscellaneousRouter = require('./routes/miscellaneous');\nconst app = express();\n\napp.use(cors({\n    origin: true,\n    credentials: true\n}))\napp.use(express.static(path.join(__dirname, '../../frontend/build')));\napp.get('/', function (req, res) {\n    res.sendFile(path.join(__dirname, '../../frontend/build', 'index.html'));\n});\n\napp.use(\n    session({\n        secret: 'apache-age-viewer',\n        secure: true,\n        resave: false,\n        saveUninitialized: true,\n        proxy: true,\n        genid: (req) => {\n            return uuid.v4();\n        },\n    })\n);\napp.use(logger('common', {stream}));\napp.use(express.json());\napp.use(express.urlencoded({extended: false}));\napp.use(cookieParser());\n\napp.use('/api/v1/*', sessionRouter);\napp.use('/api/v1/miscellaneous', miscellaneousRouter);\napp.use('/api/v1/cypher', cypherRouter);\napp.use('/api/v1/db', databaseRouter);\n\n// Error Handler\napp.use(function (err, req, res, next) {\n    // TODO: logger\n    console.error(err);\n    res.status(err.status || 500).json(\n        {\n            severity: err.severity || '',\n            message: err.message || '',\n            code: err.code || ''\n        }\n    );\n});\n\nprocess.on('uncaughtException', function (exception) {\n    console.log(exception);\n});\n\nmodule.exports = app;\n"],"mappings":"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"}